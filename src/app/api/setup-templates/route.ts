
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";

export async function GET() {
    const templates = [
        {
            name: "ุชุฃููุฏ ุงูุชุณุฌูู",
            trigger: "ON_REGISTRATION",
            body: `๐ *ุฅุดุนุงุฑ ูุธุงู ุฃููุฑุณูุฒ ููุณูุฑูุงุช*

ูุฑุญุจุงู {name}ุ

ุชู ุชุณุฌููู ุจูุฌุงุญ ูู ุฎุฏูุงุช ุงูุงุนุชูุงุฏ ุงููููู.

๐ *ุจูุงูุงุช ุงูุชุณุฌูู:*
โข ุฑูู ุงูููู: {applicant_code}
โข ุงููููุฉ: {profession}
โข ูุฑูุฒ ุงูุงุฎุชุจุงุฑ: {location}

ุณูุชู ุงูุชูุงุตู ูุนู ูุฅููุงู ุงูุฅุฌุฑุงุกุงุช.

_ุฃููุฑุณูุฒ ููุณูุฑูุงุช - ุฎุฏูุงุชูู ุฃูุงูุฉ_`
        },
        {
            name: "ุจูุงูุงุช ุงูุฏุฎูู",
            trigger: "ON_ACCOUNT_CREATED",
            body: `๐ *ุจูุงูุงุช ุงูุฏุฎูู ูููุตุฉ ุงูุงุฎุชุจุงุฑ*

ูุฑุญุจุงู {name}ุ

ุชู ุฅูุดุงุก ุญุณุงุจู ูู ููุตุฉ ุงูุงุฎุชุจุงุฑ:

๐ง ุงูุจุฑูุฏ: {email}
๐ ูููุฉ ุงููุฑูุฑ: {password}

โ๏ธ ูุฑุฌู ุงูุงุญุชูุงุธ ุจูุฐู ุงูุจูุงูุงุช ูุนุฏู ูุดุงุฑูุชูุง.`
        },
        {
            name: "ุชุฃููุฏ ููุนุฏ ุงูุงุฎุชุจุงุฑ",
            trigger: "ON_EXAM_SCHEDULED",
            body: `๐ *ุชุฃููุฏ ููุนุฏ ุงุฎุชุจุงุฑ - ุฃููุฑุณูุฒ ููุณูุฑูุงุช*

ูุฑุญุจุงู {name}ุ

ุชู ุชุฃููุฏ ุญุฌุฒ ููุนุฏ ุงุฎุชุจุงุฑู ุจูุฌุงุญ.

๐ *ุงูุชูุงุตูู:*
โข ุงููููุฉ: {profession}
โข ุงูุชุงุฑูุฎ: {exam_date}
โข ุงูููุช: {exam_time}
โข ุงููุฏููุฉ: {location}

๐ *ุนููุงู ุงููุฑูุฒ:*
{location_address}

๐บ๏ธ *ุงููููุน:*
{location_url}

โ๏ธ *ุชุนูููุงุช ูุงูุฉ:*
- ุงูุญุถูุฑ ูุจู ุงูููุนุฏ ุจู 30 ุฏูููุฉ.
- ุฅุญุถุงุฑ ุฌูุงุฒ ุงูุณูุฑ ุงูุฃุตูู.

_ุฃููุฑุณูุฒ ููุณูุฑูุงุช - ูุชููู ููู ุงูุชูููู_`
        },
        {
            name: "ุชุนุฏูู ููุนุฏ ุงูุงุฎุชุจุงุฑ",
            trigger: "ON_EXAM_MODIFIED",
            body: `โ๏ธ *ุชุญุฏูุซ ููุนุฏ ุงูุงุฎุชุจุงุฑ - ุฃููุฑุณูุฒ ููุณูุฑูุงุช*

ูุฑุญุจุงู {name}ุ

ููุฏ ุฅุดุนุงุฑู ุจุฃูู ุชู ุชุนุฏูู ููุนุฏ ุงุฎุชุจุงุฑู.

๐ *ุงูููุนุฏ ุงูุฌุฏูุฏ:*
โข ุงูุชุงุฑูุฎ: {exam_date}
โข ุงูููุช: {exam_time}
โข ุงููููุน: {location}

ูุฑุฌู ุงูุงูุชุฒุงู ุจุงูููุนุฏ ุงูุฌุฏูุฏ.`
        },
        {
            name: "ุชุณุฌูู ุบูุงุจ",
            trigger: "ON_EXAM_ABSENT",
            body: `โ *ุฅุดุนุงุฑ ุบูุงุจ - ุฃููุฑุณูุฒ ููุณูุฑูุงุช*

ูุฑุญุจุงู {name}ุ

ูุคุณููุง ุฅุจูุงุบู ุจุฃูู ุชู ุชุณุฌููู "ุบุงุฆุจ" ุนู ููุนุฏ ุงูุงุฎุชุจุงุฑ ุงููุญุฏุฏ.

ูุฑุฌู ูุฑุงุฌุนุฉ ุงูููุชุจ ูุชุฑุชูุจ ููุนุฏ ุฌุฏูุฏ ุฃู ุงูุชูุงุตู ูุนูุง ููุนุฑูุฉ ุงูุฅุฌุฑุงุกุงุช ุงููุงุฒูุฉ ูุฅุนุงุฏุฉ ุงูุฌุฏููุฉ.`
        },
        {
            name: "ุชุฐููุฑ ุจุงูุงุฎุชุจุงุฑ",
            trigger: "ON_EXAM_REMINDER",
            body: `โฐ *ุชุฐููุฑ ุจููุนุฏ ุงูุงุฎุชุจุงุฑ - ุฃููุฑุณูุฒ ููุณูุฑูุงุช*

ูุฑุญุจุงู {name}ุ

ูุฐูุฑู ุจููุนุฏ ุงุฎุชุจุงุฑู ุบุฏุงู.

๐ *ุงูุชูุงุตูู:*
โข ุงูุชุงุฑูุฎ: {exam_date}
โข ุงูููุช: {exam_time}
โข ุงููููุน: {location}

๐ *ุงูุนููุงู:*
{location_address}

โ๏ธ *ููุงุญุธุงุช:*
- ูุฑุฌู ุงูุญุถูุฑ ูุจู ุงูููุนุฏ ุจูุตู ุณุงุนุฉ.
- ุฅุญุถุงุฑ ุงููููุฉ/ุงูุฌูุงุฒ ุงูุฃุตู.`
        },
        {
            name: "ุฅุตุฏุงุฑ ุชุฐูุฑุฉ ุงูุณูุฑ",
            trigger: "ON_TICKET_ISSUED",
            body: `๐ซ *ุชู ุฅุตุฏุงุฑ ุชุฐูุฑุฉ ุงูุณูุฑ - ุฃููุฑุณูุฒ ููุณูุฑูุงุช*

ูุฑุญุจุงู {name}ุ

ุชู ุฅุตุฏุงุฑ ุชุฐูุฑุฉ ุณูุฑู ุจูุฌุงุญ.

๐ *ุชูุงุตูู ุงูุฑุญูุฉ:*
โข ุฑูู ุงูุชุฐูุฑุฉ: {ticket_number}
โข ุงูุดุฑูุฉ: {transport_company}
โข ุฎุท ุงูุณูุฑ: {departure_location} โฌ๏ธ {arrival_location}
โข ุงูุชุงุฑูุฎ: {travel_date}
โข ุฑูู ุงูุจุงุต: {bus_number} | ุงูููุนุฏ: {seat_number}

โ๏ธ ูุฑุฌู ุงูุชูุงุฌุฏ ูู ูุญุทุฉ ุงูุงูุทูุงู ูุจู ุงูููุนุฏ ุจุณุงุนุฉ.

_ุฑุญูุฉ ุณุนูุฏุฉ ูุชููุงูุง ููู!_`
        },
        {
            name: "ุชุนุฏูู ุชุฐูุฑุฉ ุงูุณูุฑ",
            trigger: "ON_TICKET_MODIFIED",
            body: `โ๏ธ *ุชุนุฏูู ุชุฐูุฑุฉ ุณูุฑ - ุฃููุฑุณูุฒ ููุณูุฑูุงุช*

ูุฑุญุจุงู {name}ุ

ุชู ุชุนุฏูู ุจูุงูุงุช ุชุฐูุฑุฉ ุณูุฑู.

๐ *ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ:*
โข ุฑูู ุงูุชุฐูุฑุฉ: {ticket_number}
โข ุงูุชุงุฑูุฎ: {travel_date}
โข ุฎุท ุงูุณูุฑ: {departure_location} โฌ๏ธ {arrival_location}

ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุจูุงูุงุช ูุงูุชุฃูุฏ ูููุง.`
        },
        {
            name: "ุฅูุบุงุก ุชุฐูุฑุฉ ุงูุณูุฑ",
            trigger: "ON_TICKET_CANCELLED",
            body: `๐ซ *ุฅูุบุงุก ุชุฐูุฑุฉ ุณูุฑ - ุฃููุฑุณูุฒ ููุณูุฑูุงุช*

ูุฑุญุจุงู {name}ุ

ููุฏ ุฅุจูุงุบู ุจุฃูู ุชู ุฅูุบุงุก ุชุฐูุฑุฉ ุงูุณูุฑ ุฑูู {ticket_number}.

ุฅุฐุง ูุงู ูุฏูู ุฃู ุงุณุชูุณุงุฑุ ูุฑุฌู ุงูุชูุงุตู ูุนูุง.`
        },
        {
            name: "ุชููุฆุฉ ุจุงููุฌุงุญ",
            trigger: "ON_PASS",
            body: `๐ *ุชููุฆุฉ ุจุงููุฌุงุญ - ุฃููุฑุณูุฒ ููุณูุฑูุงุช*

ุฃูู ูุจุฑูู {name}! ๐น

ูุณุนุฏูุง ุฅุจูุงุบู ุจุงุฌุชูุงุฒู ุงูุงุฎุชุจุงุฑ ุงููููู ุจูุฌุงุญ.

ุณูุชู ุงูุชูุงุตู ูุนู ูุฑูุจุงู ูุงุณุชููุงู ุจุงูู ุงูุฅุฌุฑุงุกุงุช.

_ูุชููู ูู ูุณุชูุจูุงู ููููุงู ูุดุฑูุงู!_`
        },
        {
            name: "ุฅุฑุณุงู ุดูุงุฏุฉ",
            trigger: "ON_CERTIFICATE_SENT",
            body: `๐ *ุชููุฆุฉ ูุงุณุชูุงู ุงูุดูุงุฏุฉ - ุฃููุฑุณูุฒ ููุณูุฑูุงุช*

ูุฑุญุจุงู {name}ุ

ูุณุฑูุง ุฅุฑุณุงู ุดูุงุฏุฉ ุงูุงุนุชูุงุฏ ุงููููู ุงูุฎุงุตุฉ ุจู ูุฑููุฉ ูุน ูุฐู ุงูุฑุณุงูุฉ.

ูุชููู ูู ุงูุชูููู ูู ูุณูุฑุชู ุงูููููุฉ!

_ุฃููุฑุณูุฒ ููุณูุฑูุงุช_`
        },
        {
            name: "ูุชูุฌุฉ ุงูุงุฎุชุจุงุฑ (ุฑุงุณุจ)",
            trigger: "ON_FAIL",
            body: `๐ *ูุชูุฌุฉ ุงูุงุฎุชุจุงุฑ - ุฃููุฑุณูุฒ ููุณูุฑูุงุช*

ูุฑุญุจุงู {name}ุ

ููุฏ ุฅุจูุงุบู ุจูุชูุฌุฉ ุงุฎุชุจุงุฑู (ูู ุชุฌุชุฒ).

ูุง ุชูุฃุณุ ููููู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู ูุชุญุฏูุฏ ููุนุฏ ูุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ. ูุญู ููุง ููุณุงุนุฏุชู.

_ุฃููุฑุณูุฒ ููุณูุฑูุงุช_`
        }
    ];

    try {
        const results = [];
        for (const t of templates) {
            // Find existing
            const existing = await prisma.messagingTemplate.findFirst({
                where: { trigger: t.trigger }
            });

            if (existing) {
                // Update
                const updated = await prisma.messagingTemplate.update({
                    where: { id: existing.id },
                    data: {
                        name: t.name,
                        body: t.body,
                        subject: t.name, // Use name as subject for now
                        active: true
                    }
                });
                results.push({ ...updated, status: 'updated' });
            } else {
                // Create
                const created = await prisma.messagingTemplate.create({
                    data: {
                        name: t.name,
                        trigger: t.trigger,
                        body: t.body,
                        subject: t.name,
                        type: "WHATSAPP", // Default
                        active: true
                    }
                });
                results.push({ ...created, status: 'created' });
            }
        }
        return NextResponse.json({ success: true, results });
    } catch (error) {
        return NextResponse.json({ error: String(error) }, { status: 500 });
    }
}
